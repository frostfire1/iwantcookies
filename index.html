<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Local Storage Inspector (Local-only)</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif; padding: 16px; }
    pre { background:#f6f8fa; padding:12px; border-radius:6px; overflow:auto; max-height:40vh }
    button { margin:6px 0; padding:8px 12px; border-radius:6px; }
  </style>
</head>
<body>
  <h1>Local Storage Inspector â€” Local Only</h1>
  <p>This page reads cookies, localStorage, sessionStorage and attempts to list IndexedDB databases (if allowed by browser). Nothing is sent anywhere.</p>

  <button id="inspectBtn">Inspect & Show</button>
  <button id="downloadBtn">Download JSON</button>
  <pre id="output">Click "Inspect & Show".</pre>

<script>
async function readIndexedDBInfo() {
  const info = {};
  // Some browsers support indexedDB.databases()
  if (indexedDB && indexedDB.databases) {
    try {
      const dbs = await indexedDB.databases();
      info.databases = dbs.map(d => ({ name: d.name, version: d.version }));
    } catch (e) {
      info.databases = { error: 'indexedDB.databases() failed: ' + e.message };
    }
  } else {
    info.databases = { note: 'indexedDB.databases() not supported in this browser' };
  }
  return info;
}

function readCookies() {
  // document.cookie returns a single string "k=v; k2=v2"
  // We parse into object pairs
  const raw = document.cookie || '';
  const obj = {};
  if (!raw) return obj;
  raw.split(';').forEach(pair => {
    const [k, ...rest] = pair.trim().split('=');
    obj[decodeURIComponent(k)] = decodeURIComponent(rest.join('=') || '');
  });
  return obj;
}

function readStorage(storage) {
  const o = {};
  for (let i=0;i<storage.length;i++) {
    const k = storage.key(i);
    try {
      o[k] = storage.getItem(k);
    } catch(e) {
      o[k] = `ERROR: ${e.message}`;
    }
  }
  return o;
}

async function inspectAll() {
  const result = {
    timestamp: new Date().toISOString(),
    location: window.location.href,
    userAgent: navigator.userAgent,
    cookies: readCookies(),
    localStorage: readStorage(localStorage),
    sessionStorage: readStorage(sessionStorage),
    indexedDB: await readIndexedDBInfo()
  };
  return result;
}

function pretty(obj) {
  return JSON.stringify(obj, null, 2);
}

document.getElementById('inspectBtn').addEventListener('click', async () => {
  try {
    const data = await inspectAll();
    document.getElementById('output').textContent = pretty(data);
    // Also log to console for easy devtools inspection
    console.log('Local-only storage dump:', data);
    // keep the last dump for download
    window.__LAST_LOCAL_DUMP__ = data;
  } catch (err) {
    document.getElementById('output').textContent = 'Error: ' + err.message;
  }
});

document.getElementById('downloadBtn').addEventListener('click', () => {
  const data = window.__LAST_LOCAL_DUMP__;
  if (!data) {
    alert('No data to download. Click "Inspect & Show" first.');
    return;
  }
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'storage-dump-' + (new Date().toISOString()).replace(/[:.]/g,'-') + '.json';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
});
</script>
</body>
</html>
